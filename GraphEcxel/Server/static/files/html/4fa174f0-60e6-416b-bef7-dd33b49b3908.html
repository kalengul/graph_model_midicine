<!DOCTYPE html>
<html>
    <head>
        <title>6f675adf-a3ba-4691-8d64-bcfecaac0623</title>
        <meta charset="utf-8">
        <link rel="stylesheet" href="./css/index.css">
        <style>
            .Graphcontainer{
                width: 98%;
                height: 85vh;

                border: solid 0.5px black;
                border-radius: 7px;
            }

            .svgGraph{
                width: 100%;
                height: 100%;
            }   
        </style>
        <script src="./d3.v7.js"></script>
    </head>
    <body>
        <main>
            <div class="flex jc-center">
                <h1>6f675adf-a3ba-4691-8d64-bcfecaac0623</h1>
            </div>
            <br/>
            <div class='Graphcontainer' >
                <svg class='svgGraph'> </svg>
            </div>
        </main>

        <script>
            const colors = {
                selectNode: "#E8BD6D",
                selectLink: "#8B7474",
                node: "#E9EEF4",
                link: '#B8B5B5'
            }

            const nodeView = {
                r: 30
            }

            const graphData = {"directed":true,"multigraph":false,"graph":{},"nodes":[{"name":"небиволол","label":"prepare","weight":5,"id":"6f675adf-a3ba-4691-8d64-bcfecaac0623","level":2,"r":30,"y":385,"x":1200},{"name":"внутрь","label":"absorbtion","weight":5,"id":"00ea225c-415a-4f34-b041-a870468bc931","level":3,"r":30,"y":515,"x":27.272727272727273},{"name":"брадикардия","label":"side_e","weight":5,"id":"fd36836c-4483-45d7-a5d9-0d25854bdb65","level":3,"r":30,"y":515,"x":107.27272727272728},{"name":"головокружение","label":"side_e","weight":5,"id":"d1fde7ef-b1e3-4c21-9417-bf5b5cb842c7","level":3,"r":30,"y":515,"x":187.27272727272728},{"name":"декомпенсация хсн","label":"side_e","weight":5,"id":"55a580b2-94e7-426a-ae6c-f43f59e82af0","level":3,"r":30,"y":515,"x":267.27272727272725},{"name":"ортостатический гипотензия","label":"side_e","weight":5,"id":"81431f98-9e8c-499b-bb58-beab44ddd4d2","level":3,"r":30,"y":515,"x":347.27272727272725},{"name":"непереносимость препарат","label":"side_e","weight":5,"id":"5b4c9d7c-e9f3-4eb9-b779-132a8c48bf3d","level":3,"r":30,"y":515,"x":427.27272727272725},{"name":"ав блокада i степень","label":"side_e","weight":5,"id":"891a7058-8f35-4c9b-963a-9d503fda8768","level":3,"r":30,"y":515,"x":507.27272727272725},{"name":"отёк нижний конечность","label":"side_e","weight":5,"id":"ce4f6ccc-51ee-482c-8181-c5c7837c6e88","level":3,"r":30,"y":515,"x":587.2727272727273},{"name":"ангионевротический отёк","label":"side_e","weight":5,"id":"4de30b9c-49fc-4109-865b-a4a4a0ddf870","level":3,"r":30,"y":515,"x":667.2727272727273},{"name":"гиперчувствительность","label":"side_e","weight":5,"id":"d9bdd110-6254-4ee1-8ec5-236960316af5","level":3,"r":30,"y":515,"x":747.2727272727273},{"name":"депрессия","label":"side_e","weight":5,"id":"d0ed62c0-5b8b-433a-801a-79f6a4c6171a","level":3,"r":30,"y":515,"x":827.2727272727273},{"name":"«кошмарный» сновидение","label":"side_e","weight":5,"id":"ae28f3a5-b15b-41c7-8fe4-248a17d023e9","level":3,"r":30,"y":515,"x":907.2727272727273},{"name":"головной боль","label":"side_e","weight":5,"id":"152b1794-19f8-4b6b-aeb1-f405edf1ebbc","level":3,"r":30,"y":515,"x":987.2727272727273},{"name":"парестезия","label":"side_e","weight":5,"id":"483ed46b-99fc-4e2d-b3b9-b04c470ecea1","level":3,"r":30,"y":515,"x":1067.2727272727273},{"name":"обморок","label":"side_e","weight":5,"id":"46eda76e-0b9a-4b4f-93e1-6560ef370163","level":3,"r":30,"y":515,"x":1147.2727272727273},{"name":"зрение","label":"side_e","weight":5,"id":"ee225586-c6a3-4bd9-b6f7-fc8230393166","level":3,"r":30,"y":515,"x":1227.2727272727273},{"name":"сердечный недостаточность","label":"side_e","weight":5,"id":"838b824c-995b-4cd3-b82f-45ff5044ffd6","level":3,"r":30,"y":515,"x":1307.2727272727273},{"name":"замедление ав-проводимость","label":"side_e","weight":5,"id":"e1b30bb8-1e1d-40c0-9fe1-5de459f2728a","level":3,"r":30,"y":515,"x":1387.2727272727273},{"name":"выраженный снижение ад","label":"side_e","weight":5,"id":"9b78bcb8-ca6a-4433-8171-cc580eb037d8","level":3,"r":30,"y":515,"x":1467.2727272727273},{"name":"усугубление перемежаться хромота","label":"side_e","weight":5,"id":"63f5f569-bbfb-4b18-b001-9e7c0b7550cc","level":3,"r":30,"y":515,"x":1547.2727272727273},{"name":"одышка","label":"side_e","weight":5,"id":"3de4bd5f-9589-4875-9f88-27828cc62f5d","level":3,"r":30,"y":515,"x":1627.2727272727273},{"name":"бронхоспазм","label":"side_e","weight":5,"id":"f403a270-60e9-4dcc-9817-eef7d9d6ec57","level":3,"r":30,"y":515,"x":1707.2727272727273},{"name":"тошнота","label":"side_e","weight":5,"id":"8791f6bc-27ed-4b8c-b3f6-bc87134e1bb6","level":3,"r":30,"y":515,"x":1787.2727272727273},{"name":"запор","label":"side_e","weight":5,"id":"36c718cc-af20-4486-a2e9-c7dfc062e9ae","level":3,"r":30,"y":515,"x":1867.2727272727273},{"name":"диарея","label":"side_e","weight":5,"id":"d5412ab3-82a1-4247-abdf-af1fa3198fe1","level":3,"r":30,"y":515,"x":1947.2727272727273},{"name":"диспепсия","label":"side_e","weight":5,"id":"3dbbdb47-e4c7-4010-867c-7a602db532d3","level":3,"r":30,"y":515,"x":2027.2727272727273},{"name":"метеоризм","label":"side_e","weight":5,"id":"c2a01c07-5ab8-46ba-8c3f-ddecfa45a157","level":3,"r":30,"y":515,"x":2107.272727272727},{"name":"рвота","label":"side_e","weight":5,"id":"795a833a-66fb-4b43-93e5-c2103ed91576","level":3,"r":30,"y":515,"x":2187.272727272727},{"name":"кожный зуд","label":"side_e","weight":5,"id":"d3ff0427-a3e3-4834-91a7-970d7838968f","level":3,"r":30,"y":515,"x":2267.272727272727},{"name":"кожный сыпь эритематозный характер","label":"side_e","weight":5,"id":"a9aae4f7-e712-4fb7-9d23-2d75f064f5aa","level":3,"r":30,"y":515,"x":2347.272727272727},{"name":"усугубление течение псориаз","label":"side_e","weight":5,"id":"e82b568f-5049-4f3d-8982-218ae73e3045","level":3,"r":30,"y":515,"x":2427.272727272727},{"name":"крапивница","label":"side_e","weight":5,"id":"ca8b568f-f81c-4dd7-a964-35b6cf7e9a06","level":3,"r":30,"y":515,"x":2507.272727272727},{"name":"эректильный дисфункция","label":"side_e","weight":5,"id":"6a3cc2b8-693d-4006-a662-7e1a74791625","level":3,"r":30,"y":515,"x":2587.272727272727},{"name":"повышенный утомляемость","label":"side_e","weight":5,"id":"a3a3e32f-7731-4443-9f1e-eb5ed6b642a4","level":3,"r":30,"y":515,"x":2667.272727272727},{"name":"отёк","label":"side_e","weight":5,"id":"9b5dcc7d-daff-4773-ab5e-0f80d2177a70","level":3,"r":30,"y":515,"x":2747.272727272727},{"name":"желудочковый аритмия","label":"side_e","weight":5,"id":"cdc46efe-6afa-4310-8453-f5da04fca1d5","level":3,"r":30,"y":515,"x":2827.272727272727},{"name":"полиморфный желудочковый тахикардия тип «пируэт»","label":"side_e","weight":5,"id":"add29d07-082f-4ed2-8b00-6c5e385507c1","level":3,"r":30,"y":515,"x":2907.272727272727},{"name":"удлинение время атриовентрикулярный проведение","label":"side_e","weight":5,"id":"25f64380-5fce-4c69-9f87-78378e4494a0","level":3,"r":30,"y":515,"x":2987.272727272727},{"name":"усиление отрицательный инотропный действие","label":"side_e","weight":5,"id":"f0a16b62-bc4b-4720-a474-ddce2b178baa","level":3,"r":30,"y":515,"x":3067.272727272727},{"name":"ав-блокада","label":"side_e","weight":5,"id":"b503a882-2ca6-44c0-9d05-6b40a3a8e4a3","level":3,"r":30,"y":515,"x":3147.272727272727},{"name":"бета-адреноблокатор","label":"group","weight":5,"id":"66852cb7-0d78-4d87-9d82-654e236d0d4e","level":0,"r":30,"y":125,"x":1200},{"name":"селективный бетаадреноблокатор","label":"group","weight":5,"id":"13e1f2ef-7978-4319-b70d-01bb34a66646","level":1,"r":30,"y":255,"x":1200},{"name":"модулировать высвобождение эндотелиальный вазодилатируть фактор оксид азот","label":"mechanism","weight":5,"id":"09123ce1-4d6b-4f40-a61b-6d92538e1bd7","level":5,"r":30,"y":775,"x":400},{"name":"блокировать","label":"mechanism","weight":5,"id":"d65d8748-e08e-47f5-b526-6f0fe1f301c4","level":3,"r":30,"y":515,"x":3227.272727272727},{"name":"сосудорасширяющий действие","label":"action","weight":5,"id":"f53eb4e6-ebf2-4fa3-8a72-e1918f1bf042","level":6,"r":30,"y":905,"x":600},{"name":"антигипертензивный действие","label":"mechanism","weight":5,"id":"044203d1-6b15-4d41-a670-5959c3ae290b","level":7,"r":30,"y":1035,"x":600},{"name":"антиангинальный действие","label":"action","weight":5,"id":"db3e9617-f89d-4c39-b203-9beb35642f8e","level":10,"r":30,"y":1425,"x":1200},{"name":"антиаритмический действие","label":"mechanism","weight":5,"id":"70492bf9-f39d-4c7e-8915-d392a07da7c4","level":7,"r":30,"y":1035,"x":680},{"name":"подавление автоматизм сердце","label":"mechanism","weight":5,"id":"a1a506df-e66b-4963-9654-b69e93ea0b47","level":5,"r":30,"y":775,"x":480},{"name":"потребность миокард в кислород","label":"mechanism","weight":5,"id":"e7480621-fa32-4e48-a7b7-5e4815abd343","level":9,"r":30,"y":1295,"x":1200},{"name":"снижать общий периферический сосудистый сопротивление","label":"mechanism","weight":5,"id":"87d869ac-75b7-4b83-b851-68d9a9a1ec5e","level":5,"r":30,"y":775,"x":560},{"name":"замедление атриовентрикулярный проводимость","label":"mechanism","weight":5,"id":"3d450d5f-a217-484d-b0de-3bfd98bf771f","level":6,"r":30,"y":905,"x":680},{"name":"урежение частота сердечный сокращение","label":"mechanism","weight":5,"id":"55b3d7bb-8bda-485a-8cbf-0733e3030ca1","level":11,"r":30,"y":1555,"x":1200},{"name":"артериальный гипотензия","label":"side_e","weight":5,"id":"24703a33-adf4-46e2-8b19-bf295597c49e","level":3,"r":30,"y":515,"x":3307.272727272727},{"name":"почки","label":"excretion","weight":5,"id":"2ceda02b-3a7e-4392-a695-93c6b857232b","level":3,"r":30,"y":515,"x":3387.272727272727},{"name":"кишечник","label":"excretion","weight":5,"id":"f083a39c-b665-4c72-ae24-5e3cd202c9de","level":3,"r":30,"y":515,"x":3467.272727272727},{"name":"адренорецептор β1","label":"mechanism","weight":5,"id":"bdf45578-bb24-44be-abb0-953559dae784","level":4,"r":30,"y":645,"x":300},{"name":"адренорецептор β1 кардиоселективный","label":"mechanism","weight":5,"id":"fed0a106-4e04-47bc-a4cb-6a067998460c","level":4,"r":30,"y":645,"x":380},{"name":"адренорецептор β1 синаптический","label":"mechanism","weight":5,"id":"03c7f91f-2d1d-40e1-964b-c7b0f2e275d2","level":4,"r":30,"y":645,"x":460},{"name":"адренорецептор β1 постсинаптический","label":"mechanism","weight":5,"id":"ebdd9b2c-df0f-46bd-9c76-800500384dda","level":4,"r":30,"y":645,"x":540},{"name":"снижение преднагрузка","label":"mechanism","weight":5,"id":"a71178ae-9706-4917-985f-3b858db10bf3","level":8,"r":30,"y":1165,"x":600},{"name":"снижение постнагрузка","label":"mechanism","weight":5,"id":"18f66d1d-c3cb-4cfe-96ca-c6eb61e5d9da","level":8,"r":30,"y":1165,"x":680}],"links":[{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"fd36836c-4483-45d7-a5d9-0d25854bdb65"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"d1fde7ef-b1e3-4c21-9417-bf5b5cb842c7"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"55a580b2-94e7-426a-ae6c-f43f59e82af0"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"81431f98-9e8c-499b-bb58-beab44ddd4d2"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"5b4c9d7c-e9f3-4eb9-b779-132a8c48bf3d"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"891a7058-8f35-4c9b-963a-9d503fda8768"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"ce4f6ccc-51ee-482c-8181-c5c7837c6e88"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"4de30b9c-49fc-4109-865b-a4a4a0ddf870"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"d9bdd110-6254-4ee1-8ec5-236960316af5"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"d0ed62c0-5b8b-433a-801a-79f6a4c6171a"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"ae28f3a5-b15b-41c7-8fe4-248a17d023e9"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"152b1794-19f8-4b6b-aeb1-f405edf1ebbc"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"483ed46b-99fc-4e2d-b3b9-b04c470ecea1"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"46eda76e-0b9a-4b4f-93e1-6560ef370163"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"ee225586-c6a3-4bd9-b6f7-fc8230393166"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"838b824c-995b-4cd3-b82f-45ff5044ffd6"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"e1b30bb8-1e1d-40c0-9fe1-5de459f2728a"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"9b78bcb8-ca6a-4433-8171-cc580eb037d8"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"63f5f569-bbfb-4b18-b001-9e7c0b7550cc"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"3de4bd5f-9589-4875-9f88-27828cc62f5d"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"f403a270-60e9-4dcc-9817-eef7d9d6ec57"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"8791f6bc-27ed-4b8c-b3f6-bc87134e1bb6"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"36c718cc-af20-4486-a2e9-c7dfc062e9ae"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"d5412ab3-82a1-4247-abdf-af1fa3198fe1"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"3dbbdb47-e4c7-4010-867c-7a602db532d3"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"c2a01c07-5ab8-46ba-8c3f-ddecfa45a157"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"795a833a-66fb-4b43-93e5-c2103ed91576"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"d3ff0427-a3e3-4834-91a7-970d7838968f"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"a9aae4f7-e712-4fb7-9d23-2d75f064f5aa"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"e82b568f-5049-4f3d-8982-218ae73e3045"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"ca8b568f-f81c-4dd7-a964-35b6cf7e9a06"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"6a3cc2b8-693d-4006-a662-7e1a74791625"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"a3a3e32f-7731-4443-9f1e-eb5ed6b642a4"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"9b5dcc7d-daff-4773-ab5e-0f80d2177a70"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"cdc46efe-6afa-4310-8453-f5da04fca1d5"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"add29d07-082f-4ed2-8b00-6c5e385507c1"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"25f64380-5fce-4c69-9f87-78378e4494a0"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"f0a16b62-bc4b-4720-a474-ddce2b178baa"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"b503a882-2ca6-44c0-9d05-6b40a3a8e4a3"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"24703a33-adf4-46e2-8b19-bf295597c49e"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"d65d8748-e08e-47f5-b526-6f0fe1f301c4"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"2ceda02b-3a7e-4392-a695-93c6b857232b"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"f083a39c-b665-4c72-ae24-5e3cd202c9de"},{"source":"6f675adf-a3ba-4691-8d64-bcfecaac0623","target":"00ea225c-415a-4f34-b041-a870468bc931"},{"source":"66852cb7-0d78-4d87-9d82-654e236d0d4e","target":"13e1f2ef-7978-4319-b70d-01bb34a66646"},{"source":"13e1f2ef-7978-4319-b70d-01bb34a66646","target":"6f675adf-a3ba-4691-8d64-bcfecaac0623"},{"source":"09123ce1-4d6b-4f40-a61b-6d92538e1bd7","target":"f53eb4e6-ebf2-4fa3-8a72-e1918f1bf042"},{"source":"d65d8748-e08e-47f5-b526-6f0fe1f301c4","target":"bdf45578-bb24-44be-abb0-953559dae784"},{"source":"d65d8748-e08e-47f5-b526-6f0fe1f301c4","target":"fed0a106-4e04-47bc-a4cb-6a067998460c"},{"source":"d65d8748-e08e-47f5-b526-6f0fe1f301c4","target":"03c7f91f-2d1d-40e1-964b-c7b0f2e275d2"},{"source":"d65d8748-e08e-47f5-b526-6f0fe1f301c4","target":"ebdd9b2c-df0f-46bd-9c76-800500384dda"},{"source":"f53eb4e6-ebf2-4fa3-8a72-e1918f1bf042","target":"044203d1-6b15-4d41-a670-5959c3ae290b"},{"source":"044203d1-6b15-4d41-a670-5959c3ae290b","target":"a71178ae-9706-4917-985f-3b858db10bf3"},{"source":"044203d1-6b15-4d41-a670-5959c3ae290b","target":"18f66d1d-c3cb-4cfe-96ca-c6eb61e5d9da"},{"source":"db3e9617-f89d-4c39-b203-9beb35642f8e","target":"55b3d7bb-8bda-485a-8cbf-0733e3030ca1"},{"source":"a1a506df-e66b-4963-9654-b69e93ea0b47","target":"3d450d5f-a217-484d-b0de-3bfd98bf771f"},{"source":"e7480621-fa32-4e48-a7b7-5e4815abd343","target":"db3e9617-f89d-4c39-b203-9beb35642f8e"},{"source":"3d450d5f-a217-484d-b0de-3bfd98bf771f","target":"70492bf9-f39d-4c7e-8915-d392a07da7c4"},{"source":"3d450d5f-a217-484d-b0de-3bfd98bf771f","target":"55b3d7bb-8bda-485a-8cbf-0733e3030ca1"},{"source":"bdf45578-bb24-44be-abb0-953559dae784","target":"09123ce1-4d6b-4f40-a61b-6d92538e1bd7"},{"source":"bdf45578-bb24-44be-abb0-953559dae784","target":"87d869ac-75b7-4b83-b851-68d9a9a1ec5e"},{"source":"bdf45578-bb24-44be-abb0-953559dae784","target":"a1a506df-e66b-4963-9654-b69e93ea0b47"},{"source":"a71178ae-9706-4917-985f-3b858db10bf3","target":"e7480621-fa32-4e48-a7b7-5e4815abd343"},{"source":"18f66d1d-c3cb-4cfe-96ca-c6eb61e5d9da","target":"e7480621-fa32-4e48-a7b7-5e4815abd343"}],"name":["6f675adf-a3ba-4691-8d64-bcfecaac0623"],"maxLevel":12,"levelsInfo":{"levelNodesCount":{"0":1,"1":1,"2":1,"3":44,"4":4,"5":3,"6":2,"7":2,"8":2,"9":1,"10":1,"11":1}},"isParse":true}
            const window_params = {"width":1200,"height":600,"xStep":50,"yStep":100}

            console.log(graphData)

            

            if (graphData){
                const svg = d3.select("svg")
                svg.selectAll("*").remove() // Очистка предыдущего графа

                svg.attr("width",   window_params.width) //Устанавливает атрибут width
                .attr("height",   window_params.height)
                .append("g").attr('class', 'group') //добавляет новый элемент, тег которого передается в метод в качестве параметра

                const svgGroup = svg.select('g.group')

                // Масштабирование и перемещение
                const zoom = d3.zoom()
                .scaleExtent([0.1, 10])
                .on("zoom", (event)=>{ //Обновление позиционирования элементов при масштабировании
                    svgGroup.attr("transform", event.transform);
                });
                svg.call(zoom);


                const dragstarted = (event, d)=>{
                    if (!event.active) simulation.alphaTarget(0.3).restart(); // Увеличиваем "температуру" симуляции для более плавного движения
                    d.fx = d.x; // Фиксируем позицию узла
                    d.fy = d.y;
                }
                
                const dragged = (event, d)=>{
                    d.fx = event.x; // Обновляем фиксированные координаты узла
                    d.fy = event.y;
                }
                
                const dragended = (event, d)=>{
                    if (!event.active) simulation.alphaTarget(0); // Охлаждаем симуляцию после перетаскивания
                    d.fx = null; // Отпускаем узел, позволяя симуляции снова влиять на его позицию
                    d.fy = null;
                }

                // Создаем обработчик drag
                const drag = d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended);


                // Определение маркера стрелки
                svgGroup.append("defs")
                .append("marker")
                .attr("id", "arrowhead")
                .attr("markerWidth", 5) //Размер области, в которой будет отображаться маркер
                .attr("markerHeight", 4)
                .attr("refX", nodeView.r+4)
                .attr("refY", 2)
                .attr("orient", "auto")
                .append("polygon")
                .attr("points", "0 0, 5 2, 0 4")
                .style("fill", colors.link);

                
                //Добавление ссылок
                let links = svgGroup.append("g").attr('class', 'links')
                .selectAll('.link')
                .data(graphData.links) //Добавление данных
                .enter() //Нужен для ввода дополнительных значений (так как data привязывает только первое)
                .append('path')
                .attr('class', 'link')
                .attr('stroke', d=>{
                    //if((d.source.id === selectedNodes.sourseNode && d.target.id === selectedNodes.targetNode)||(d.target.id === selectedNodes.sourseNode && d.source.id === selectedNodes.targetNode)) return colors.selectLink
                    return colors.link
                }) // Цвет линии ребра
                .attr('stroke-width', d=>{
                    //if((d.source.id === selectedNodes.sourseNode && d.target.id === selectedNodes.targetNode)||(d.target.id === selectedNodes.sourseNode && d.source.id === selectedNodes.targetNode)) return 2
                    return 1
                }) // Ширина линии ребра
                .attr("marker-end", "url(#arrowhead)") // Добавление стрелки в конец ребра
                .style('pointer-events', 'none') //(устанавливает стиль) Отключение событий на ребрах (клики и т.д.)

                // Создание узлов
                let nodes = svgGroup.append("g").attr('class', 'nodes')
                .selectAll('.node')
                .data(graphData.nodes)
                .enter()
                .append('g')
                .attr('class', 'node')
                .call(drag);

                nodes.append('circle')
                .attr('class', 'node')
                .attr('id', d => d.id)
                .attr('r', d => d.r) // Радиус узла
                .attr('fill', d=>{
                    //if(selectedNodes.sourseNode === d.id || selectedNodes.targetNode === d.id) return colors.selectNode
                    return colors.node
                }) // Цвет заполнения
                .attr("cursor", "pointer")
                .on('click', (event, d) => {
                    // Добавьте логику для обработки клика по узлу
                });

                //Отображение текста v2
                nodes.append('foreignObject')
                .attr('x', d => -d.r * 0.8)
                .attr('y', d => -d.r * 0.8)
                .attr('width', d => d.r * 1.6)
                .attr('height', d => d.r * 1.6)
                .append('xhtml:div')
                .style('display', 'flex')
                .style('justify-content', 'center')
                .style('align-items', 'center')
                .style('width', '100%')
                .style('height', '100%')
                .style('font-size', '5px')
                .style('text-anchor', 'middle')
                .style('word-wrap', 'break-word')
                .style('overflow', 'hidden')
                .style('pointer-events', 'none')
                .text(d => d.name);

                //Создание симуляции силы v3
                const simulation = d3.forceSimulation(graphData.nodes)
                // Связи между узлами
                .force("link", d3.forceLink(graphData.links).id(d => d.id))//.distance(nodeView.r*10)) //!!! Сила в зависимости от количества узлов в уровне!!!!!
                // Отталкивание узлов
                .force("charge", d3.forceManyBody(graphData.nodes).strength(d=>graphData.levelsInfo.levelNodesCount[d.level]*(-100)))//-3000))
                // Центрирование по x
                .force("center", d3.forceCenter( window_params.width / 2,  window_params.height / 2))
                // Выравнивание по уровням
                .force("y", d3.forceY().strength(6)
                    .y(d =>  window_params.height * ((d.level+1) / (graphData.maxLevel-1)))) //!!!!!!!!!!Уровень с большим числом узлов шире, чем с меньшим
                // Отталкивание по x в рамках одного уровня
                .force("x", d3.forceX().strength(0.05)
                    .x( window_params.width / 2))
                // Дополнительная сила для предотвращения наложения узлов
                .force("collision", d3.forceCollide().radius(40));

                // Обновление позиций узлов и связей при каждой итерации симуляции
                //Обновление симуляции
                simulation.on('tick', () => {
                    links.attr("d", d => `M${d.source.x},${d.source.y} L${d.target.x},${d.target.y}`);
                    nodes.attr('transform', d => `translate(${d.x}, ${d.y})`); // Правильная позиция для групп
                });
            }
        </script>
    </body>
</html>