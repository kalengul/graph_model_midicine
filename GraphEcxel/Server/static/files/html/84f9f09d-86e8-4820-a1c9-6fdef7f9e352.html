<!DOCTYPE html>
<html>
    <head>
        <title>11aeaaae-ff73-4d44-8a3d-b3ec9fad5ac4,b2c4d779-0e9c-4460-9fa4-ef3225f076d4</title>
        <meta charset="utf-8">
        <link rel="stylesheet" href="./css/index.css">
        <style>
            .Graphcontainer{
                width: 98%;
                height: 85vh;

                border: solid 0.5px black;
                border-radius: 7px;
            }

            .svgGraph{
                width: 100%;
                height: 100%;
            }   
        </style>
        <script src="./d3.v7.js"></script>
    </head>
    <body>
        <main>
            <div class="flex jc-center">
                <h1>11aeaaae-ff73-4d44-8a3d-b3ec9fad5ac4,b2c4d779-0e9c-4460-9fa4-ef3225f076d4</h1>
            </div>
            <br/>
            <div class='Graphcontainer' >
                <svg class='svgGraph'> </svg>
            </div>
        </main>

        <script>
            const colors = {
                selectNode: "#E8BD6D",
                selectLink: "#8B7474",
                node: "#E9EEF4",
                link: '#B8B5B5'
            }

            const nodeView = {
                r: 30
            }

            const graphData = {"directed":true,"multigraph":false,"graph":{},"nodes":[{"name":"кардиотоническое средство негликозидный структура","label":"group","weight":5,"id":"48f1d88c-5a79-4764-bb2e-80e1b7f604da","level":0,"r":30,"y":137.5,"x":1200},{"name":"дофамин","label":"prepare","weight":5,"id":"11aeaaae-ff73-4d44-8a3d-b3ec9fad5ac4","level":1,"r":30,"y":267.5,"x":600},{"name":"почка","label":"excretion","weight":5,"id":"365d5b4d-b630-44d2-92ef-a6bef73e98c5","level":2,"r":30,"y":397.5,"x":75},{"name":"сыпь","label":"side_e","weight":5,"id":"f8565405-6317-4490-a15a-6cce67461984","level":2,"r":30,"y":397.5,"x":155},{"name":"внутривенно","label":"absorbtion","weight":5,"id":"94c67106-dab4-47bf-a2c5-4d83870e98e0","level":2,"r":30,"y":397.5,"x":235},{"name":"улучшение системный гемодинамика","label":"action","weight":5,"id":"4d08c487-ce78-4e81-ae54-299b86822a47","level":5,"r":30,"y":787.5,"x":200},{"name":"положительный инотропный эффект","label":"action","weight":5,"id":"84f31498-0b7c-4d1b-a684-164cd45a8058","level":4,"r":30,"y":657.5,"x":120},{"name":"увеличение минутный объем кровь","label":"action","weight":5,"id":"9d543d0f-3d3c-42a0-aa36-f9443f5b55ba","level":5,"r":30,"y":787.5,"x":280},{"name":"расширение","label":"action","weight":5,"id":"9028ba3c-5a53-4ace-877a-7f204c8f0273","level":4,"r":30,"y":657.5,"x":200},{"name":"усиление почечный кровоток","label":"action","weight":5,"id":"bf6bd13a-b818-47ed-8bac-5c9d88bfed24","level":4,"r":30,"y":657.5,"x":280},{"name":"повышение скорость клубочковый фильтрация","label":"action","weight":5,"id":"0c148c48-3479-445e-9fd9-d6499b6efef0","level":5,"r":30,"y":787.5,"x":360},{"name":"увеличение диурез","label":"action","weight":5,"id":"739e9a8b-d7fd-40b6-949f-ecc9d1ec2092","level":6,"r":30,"y":917.5,"x":300},{"name":"выведение натрий","label":"action","weight":5,"id":"a14760db-c1b4-4970-8061-e3a826d5aac1","level":7,"r":30,"y":1047.5,"x":200},{"name":"повышение ОПСС","label":"action","weight":5,"id":"fefdde87-7118-43c5-850a-a738ade7c3f7","level":4,"r":30,"y":657.5,"x":360},{"name":"увеличение частоты сердечных сокращений","label":"action","weight":5,"id":"462eba48-0da1-4c76-86fb-164e40ba9116","level":4,"r":30,"y":657.5,"x":440},{"name":"сужение почечный сосуд","label":"action","weight":5,"id":"a270d83b-fdf2-4f6a-ba2e-577d30eb9724","level":4,"r":30,"y":657.5,"x":520},{"name":"головная боль","label":"side_e","weight":5,"id":"45e021f4-50c6-4045-ab5f-d055ded5fe64","level":7,"r":30,"y":1047.5,"x":280},{"name":"тревожность","label":"side_e","weight":5,"id":"1c58329f-d8ae-4c36-910b-93f827611a31","level":2,"r":30,"y":397.5,"x":315},{"name":"тремор пальцы рук","label":"side_e","weight":5,"id":"38f17917-7cad-4598-85fe-f98d130ce7f4","level":2,"r":30,"y":397.5,"x":395},{"name":"экстрасистолия","label":"side_e","weight":5,"id":"0f3fc498-17ff-44f4-84db-8862e774c763","level":7,"r":30,"y":1047.5,"x":360},{"name":"мидриаз","label":"side_e","weight":5,"id":"5a4d26a1-326e-4654-b1e1-446259601446","level":2,"r":30,"y":397.5,"x":475},{"name":"ощущение сердцебиения","label":"side_e","weight":5,"id":"0c0e4875-353f-49bc-84c9-a93561692c50","level":7,"r":30,"y":1047.5,"x":440},{"name":"вазоспазм","label":"side_e","weight":5,"id":"1ca0fd77-820d-46e0-a90f-d7f1fde702c3","level":2,"r":30,"y":397.5,"x":555},{"name":"одышка","label":"side_e","weight":5,"id":"8241d14b-f650-4842-93c8-baf5f4a0bd9c","level":7,"r":30,"y":1047.5,"x":520},{"name":"тошнота","label":"side_e","weight":5,"id":"1aa8cd98-dfe8-440c-9515-bfb0d9f5cecf","level":2,"r":30,"y":397.5,"x":635},{"name":"рвота","label":"side_e","weight":5,"id":"c1ebef77-1765-480a-bdf7-ae3ef92350f3","level":2,"r":30,"y":397.5,"x":715},{"name":"полиурия","label":"side_e","weight":5,"id":"63bc5b76-6d2c-428c-ae3f-d82396b5be1f","level":7,"r":30,"y":1047.5,"x":600},{"name":"азотемия","label":"side_e","weight":5,"id":"9dd5a2ac-638f-4662-bc62-5f1762718857","level":6,"r":30,"y":917.5,"x":380},{"name":"кровотечение ЖКТ","label":"side_e","weight":5,"id":"a3172c5f-5527-4f6e-8584-4eef7157d0e6","level":5,"r":30,"y":787.5,"x":440},{"name":"белок плазма кровь","label":"prot_link","weight":5,"id":"d67c6760-5c37-4a24-b27e-c86b9c67ea84","level":2,"r":30,"y":397.5,"x":795},{"name":"печень","label":"metabol","weight":5,"id":"4e4813eb-aa15-46a6-a3c5-51136bbd207a","level":2,"r":30,"y":397.5,"x":875},{"name":"почка","label":"metabol","weight":5,"id":"e68b712b-c424-408d-aa52-87d20a5b9bc7","level":2,"r":30,"y":397.5,"x":955},{"name":"плазма","label":"metabol","weight":5,"id":"36c2bfe2-ee3b-4f20-bd86-a5dee9b26de0","level":2,"r":30,"y":397.5,"x":1035},{"name":"уменьшать диурез","label":"action","weight":5,"id":"42f0718d-1b13-47f7-8c42-3cbd98dc48bc","level":5,"r":30,"y":787.5,"x":520},{"name":"уменьшать почечный кровоток","label":"action","weight":5,"id":"94599109-6ce3-4d40-abe3-b5644997b107","level":5,"r":30,"y":787.5,"x":600},{"name":"средство гипертензивный","label":"mechanism","weight":5,"id":"815eef9f-b6c9-433b-9539-248509e6b0f8","level":2,"r":30,"y":397.5,"x":1115},{"name":"средство сосудорасширяющий","label":"mechanism","weight":5,"id":"75b35391-ea4d-47a8-802a-e1f789415b65","level":2,"r":30,"y":397.5,"x":1195},{"name":"средство диуретический","label":"mechanism","weight":5,"id":"06d9289b-2444-4004-9f8e-fb6678101de4","level":2,"r":30,"y":397.5,"x":1275},{"name":"возбуждать бета-адренорецептор бета1-адренорецептор","label":"mechanism","weight":5,"id":"b80226cc-e801-42e9-acdd-de6ab8f8110b","level":3,"r":30,"y":527.5,"x":300},{"name":"действовать дофаминовый рецептор гладкая мускулатура сосуд","label":"mechanism","weight":5,"id":"7d3b0feb-a200-4671-91ef-d818a627128b","level":3,"r":30,"y":527.5,"x":380},{"name":"действовать дофаминовый рецептор почка","label":"mechanism","weight":5,"id":"593bf463-a0a5-4223-bd7f-6aa8bdbe8157","level":3,"r":30,"y":527.5,"x":460},{"name":"возрастать систолическое АД","label":"action","weight":5,"id":"2e2d09bf-2b02-43b1-8f70-e3f6385dda5d","level":6,"r":30,"y":917.5,"x":460},{"name":"возрастать диастоическое АД","label":"action","weight":5,"id":"b0b07725-14bb-48bc-80ec-1032241183e5","level":6,"r":30,"y":917.5,"x":540},{"name":"дофамин альфа-адренорецептор альфа1-адренорецептор","label":"prepare","weight":5,"id":"b2c4d779-0e9c-4460-9fa4-ef3225f076d4","level":1,"r":30,"y":267.5,"x":680},{"name":"расширение мозговой сосуд","label":"action","weight":5,"id":"26cb6b4d-8c31-4aa6-bff6-2793e761bcaf","level":4,"r":30,"y":657.5,"x":600},{"name":"расширение мезентериальный сосуд","label":"action","weight":5,"id":"d491c8e3-249a-43b1-a921-392a480d48c9","level":4,"r":30,"y":657.5,"x":680},{"name":"расширение коронарный сосуд","label":"action","weight":5,"id":"f75e01b5-1f65-42b1-8231-53f1979ec3eb","level":4,"r":30,"y":657.5,"x":760},{"name":"расширение почечный сосуд","label":"action","weight":5,"id":"aaf8c99a-87d5-4cd7-bf6e-c78cd20ed766","level":4,"r":30,"y":657.5,"x":840},{"name":"возбуждать альфа-адренорецептор альфа1-адренорецептор","label":"mechanism","weight":5,"id":"5cf78d1a-f7d7-40a6-9d0b-02666c1242f2","level":3,"r":30,"y":527.5,"x":540}],"links":[{"source":"48f1d88c-5a79-4764-bb2e-80e1b7f604da","target":"11aeaaae-ff73-4d44-8a3d-b3ec9fad5ac4"},{"source":"48f1d88c-5a79-4764-bb2e-80e1b7f604da","target":"b2c4d779-0e9c-4460-9fa4-ef3225f076d4"},{"source":"11aeaaae-ff73-4d44-8a3d-b3ec9fad5ac4","target":"1c58329f-d8ae-4c36-910b-93f827611a31"},{"source":"11aeaaae-ff73-4d44-8a3d-b3ec9fad5ac4","target":"38f17917-7cad-4598-85fe-f98d130ce7f4"},{"source":"11aeaaae-ff73-4d44-8a3d-b3ec9fad5ac4","target":"5a4d26a1-326e-4654-b1e1-446259601446"},{"source":"11aeaaae-ff73-4d44-8a3d-b3ec9fad5ac4","target":"1ca0fd77-820d-46e0-a90f-d7f1fde702c3"},{"source":"11aeaaae-ff73-4d44-8a3d-b3ec9fad5ac4","target":"1aa8cd98-dfe8-440c-9515-bfb0d9f5cecf"},{"source":"11aeaaae-ff73-4d44-8a3d-b3ec9fad5ac4","target":"c1ebef77-1765-480a-bdf7-ae3ef92350f3"},{"source":"11aeaaae-ff73-4d44-8a3d-b3ec9fad5ac4","target":"365d5b4d-b630-44d2-92ef-a6bef73e98c5"},{"source":"11aeaaae-ff73-4d44-8a3d-b3ec9fad5ac4","target":"94c67106-dab4-47bf-a2c5-4d83870e98e0"},{"source":"11aeaaae-ff73-4d44-8a3d-b3ec9fad5ac4","target":"f8565405-6317-4490-a15a-6cce67461984"},{"source":"11aeaaae-ff73-4d44-8a3d-b3ec9fad5ac4","target":"d67c6760-5c37-4a24-b27e-c86b9c67ea84"},{"source":"11aeaaae-ff73-4d44-8a3d-b3ec9fad5ac4","target":"4e4813eb-aa15-46a6-a3c5-51136bbd207a"},{"source":"11aeaaae-ff73-4d44-8a3d-b3ec9fad5ac4","target":"e68b712b-c424-408d-aa52-87d20a5b9bc7"},{"source":"11aeaaae-ff73-4d44-8a3d-b3ec9fad5ac4","target":"36c2bfe2-ee3b-4f20-bd86-a5dee9b26de0"},{"source":"11aeaaae-ff73-4d44-8a3d-b3ec9fad5ac4","target":"815eef9f-b6c9-433b-9539-248509e6b0f8"},{"source":"11aeaaae-ff73-4d44-8a3d-b3ec9fad5ac4","target":"75b35391-ea4d-47a8-802a-e1f789415b65"},{"source":"11aeaaae-ff73-4d44-8a3d-b3ec9fad5ac4","target":"06d9289b-2444-4004-9f8e-fb6678101de4"},{"source":"4d08c487-ce78-4e81-ae54-299b86822a47","target":"739e9a8b-d7fd-40b6-949f-ecc9d1ec2092"},{"source":"84f31498-0b7c-4d1b-a684-164cd45a8058","target":"9d543d0f-3d3c-42a0-aa36-f9443f5b55ba"},{"source":"9d543d0f-3d3c-42a0-aa36-f9443f5b55ba","target":"2e2d09bf-2b02-43b1-8f70-e3f6385dda5d"},{"source":"9d543d0f-3d3c-42a0-aa36-f9443f5b55ba","target":"b0b07725-14bb-48bc-80ec-1032241183e5"},{"source":"9028ba3c-5a53-4ace-877a-7f204c8f0273","target":"a3172c5f-5527-4f6e-8584-4eef7157d0e6"},{"source":"bf6bd13a-b818-47ed-8bac-5c9d88bfed24","target":"0c148c48-3479-445e-9fd9-d6499b6efef0"},{"source":"0c148c48-3479-445e-9fd9-d6499b6efef0","target":"739e9a8b-d7fd-40b6-949f-ecc9d1ec2092"},{"source":"739e9a8b-d7fd-40b6-949f-ecc9d1ec2092","target":"a14760db-c1b4-4970-8061-e3a826d5aac1"},{"source":"739e9a8b-d7fd-40b6-949f-ecc9d1ec2092","target":"63bc5b76-6d2c-428c-ae3f-d82396b5be1f"},{"source":"fefdde87-7118-43c5-850a-a738ade7c3f7","target":"2e2d09bf-2b02-43b1-8f70-e3f6385dda5d"},{"source":"fefdde87-7118-43c5-850a-a738ade7c3f7","target":"b0b07725-14bb-48bc-80ec-1032241183e5"},{"source":"a270d83b-fdf2-4f6a-ba2e-577d30eb9724","target":"42f0718d-1b13-47f7-8c42-3cbd98dc48bc"},{"source":"a270d83b-fdf2-4f6a-ba2e-577d30eb9724","target":"94599109-6ce3-4d40-abe3-b5644997b107"},{"source":"94599109-6ce3-4d40-abe3-b5644997b107","target":"9dd5a2ac-638f-4662-bc62-5f1762718857"},{"source":"815eef9f-b6c9-433b-9539-248509e6b0f8","target":"b80226cc-e801-42e9-acdd-de6ab8f8110b"},{"source":"815eef9f-b6c9-433b-9539-248509e6b0f8","target":"5cf78d1a-f7d7-40a6-9d0b-02666c1242f2"},{"source":"75b35391-ea4d-47a8-802a-e1f789415b65","target":"7d3b0feb-a200-4671-91ef-d818a627128b"},{"source":"75b35391-ea4d-47a8-802a-e1f789415b65","target":"593bf463-a0a5-4223-bd7f-6aa8bdbe8157"},{"source":"06d9289b-2444-4004-9f8e-fb6678101de4","target":"7d3b0feb-a200-4671-91ef-d818a627128b"},{"source":"06d9289b-2444-4004-9f8e-fb6678101de4","target":"593bf463-a0a5-4223-bd7f-6aa8bdbe8157"},{"source":"b80226cc-e801-42e9-acdd-de6ab8f8110b","target":"84f31498-0b7c-4d1b-a684-164cd45a8058"},{"source":"7d3b0feb-a200-4671-91ef-d818a627128b","target":"9028ba3c-5a53-4ace-877a-7f204c8f0273"},{"source":"7d3b0feb-a200-4671-91ef-d818a627128b","target":"26cb6b4d-8c31-4aa6-bff6-2793e761bcaf"},{"source":"7d3b0feb-a200-4671-91ef-d818a627128b","target":"d491c8e3-249a-43b1-a921-392a480d48c9"},{"source":"7d3b0feb-a200-4671-91ef-d818a627128b","target":"f75e01b5-1f65-42b1-8231-53f1979ec3eb"},{"source":"7d3b0feb-a200-4671-91ef-d818a627128b","target":"aaf8c99a-87d5-4cd7-bf6e-c78cd20ed766"},{"source":"593bf463-a0a5-4223-bd7f-6aa8bdbe8157","target":"bf6bd13a-b818-47ed-8bac-5c9d88bfed24"},{"source":"593bf463-a0a5-4223-bd7f-6aa8bdbe8157","target":"4d08c487-ce78-4e81-ae54-299b86822a47"},{"source":"2e2d09bf-2b02-43b1-8f70-e3f6385dda5d","target":"45e021f4-50c6-4045-ab5f-d055ded5fe64"},{"source":"2e2d09bf-2b02-43b1-8f70-e3f6385dda5d","target":"8241d14b-f650-4842-93c8-baf5f4a0bd9c"},{"source":"2e2d09bf-2b02-43b1-8f70-e3f6385dda5d","target":"0f3fc498-17ff-44f4-84db-8862e774c763"},{"source":"2e2d09bf-2b02-43b1-8f70-e3f6385dda5d","target":"0c0e4875-353f-49bc-84c9-a93561692c50"},{"source":"b0b07725-14bb-48bc-80ec-1032241183e5","target":"45e021f4-50c6-4045-ab5f-d055ded5fe64"},{"source":"b0b07725-14bb-48bc-80ec-1032241183e5","target":"8241d14b-f650-4842-93c8-baf5f4a0bd9c"},{"source":"b0b07725-14bb-48bc-80ec-1032241183e5","target":"0f3fc498-17ff-44f4-84db-8862e774c763"},{"source":"b0b07725-14bb-48bc-80ec-1032241183e5","target":"0c0e4875-353f-49bc-84c9-a93561692c50"},{"source":"b2c4d779-0e9c-4460-9fa4-ef3225f076d4","target":"1c58329f-d8ae-4c36-910b-93f827611a31"},{"source":"b2c4d779-0e9c-4460-9fa4-ef3225f076d4","target":"38f17917-7cad-4598-85fe-f98d130ce7f4"},{"source":"b2c4d779-0e9c-4460-9fa4-ef3225f076d4","target":"5a4d26a1-326e-4654-b1e1-446259601446"},{"source":"b2c4d779-0e9c-4460-9fa4-ef3225f076d4","target":"1ca0fd77-820d-46e0-a90f-d7f1fde702c3"},{"source":"b2c4d779-0e9c-4460-9fa4-ef3225f076d4","target":"1aa8cd98-dfe8-440c-9515-bfb0d9f5cecf"},{"source":"b2c4d779-0e9c-4460-9fa4-ef3225f076d4","target":"c1ebef77-1765-480a-bdf7-ae3ef92350f3"},{"source":"b2c4d779-0e9c-4460-9fa4-ef3225f076d4","target":"fefdde87-7118-43c5-850a-a738ade7c3f7"},{"source":"b2c4d779-0e9c-4460-9fa4-ef3225f076d4","target":"462eba48-0da1-4c76-86fb-164e40ba9116"},{"source":"b2c4d779-0e9c-4460-9fa4-ef3225f076d4","target":"a270d83b-fdf2-4f6a-ba2e-577d30eb9724"},{"source":"26cb6b4d-8c31-4aa6-bff6-2793e761bcaf","target":"4d08c487-ce78-4e81-ae54-299b86822a47"},{"source":"d491c8e3-249a-43b1-a921-392a480d48c9","target":"4d08c487-ce78-4e81-ae54-299b86822a47"},{"source":"f75e01b5-1f65-42b1-8231-53f1979ec3eb","target":"4d08c487-ce78-4e81-ae54-299b86822a47"},{"source":"aaf8c99a-87d5-4cd7-bf6e-c78cd20ed766","target":"4d08c487-ce78-4e81-ae54-299b86822a47"},{"source":"5cf78d1a-f7d7-40a6-9d0b-02666c1242f2","target":"fefdde87-7118-43c5-850a-a738ade7c3f7"},{"source":"5cf78d1a-f7d7-40a6-9d0b-02666c1242f2","target":"462eba48-0da1-4c76-86fb-164e40ba9116"},{"source":"5cf78d1a-f7d7-40a6-9d0b-02666c1242f2","target":"a270d83b-fdf2-4f6a-ba2e-577d30eb9724"}],"name":["11aeaaae-ff73-4d44-8a3d-b3ec9fad5ac4","b2c4d779-0e9c-4460-9fa4-ef3225f076d4"],"maxLevel":8,"levelsInfo":{"levelNodesCount":{"0":1,"1":2,"2":16,"3":4,"4":10,"5":6,"6":4,"7":6}},"isParse":true}
            const window_params = {"width":1200,"height":600,"xStep":50,"yStep":100}

            console.log(graphData)

            

            if (graphData){
                const svg = d3.select("svg")
                svg.selectAll("*").remove() // Очистка предыдущего графа

                svg.attr("width",   window_params.width) //Устанавливает атрибут width
                .attr("height",   window_params.height)
                .append("g").attr('class', 'group') //добавляет новый элемент, тег которого передается в метод в качестве параметра

                const svgGroup = svg.select('g.group')

                // Масштабирование и перемещение
                const zoom = d3.zoom()
                .scaleExtent([0.1, 10])
                .on("zoom", (event)=>{ //Обновление позиционирования элементов при масштабировании
                    svgGroup.attr("transform", event.transform);
                });
                svg.call(zoom);


                const dragstarted = (event, d)=>{
                    if (!event.active) simulation.alphaTarget(0.3).restart(); // Увеличиваем "температуру" симуляции для более плавного движения
                    d.fx = d.x; // Фиксируем позицию узла
                    d.fy = d.y;
                }
                
                const dragged = (event, d)=>{
                    d.fx = event.x; // Обновляем фиксированные координаты узла
                    d.fy = event.y;
                }
                
                const dragended = (event, d)=>{
                    if (!event.active) simulation.alphaTarget(0); // Охлаждаем симуляцию после перетаскивания
                    d.fx = null; // Отпускаем узел, позволяя симуляции снова влиять на его позицию
                    d.fy = null;
                }

                // Создаем обработчик drag
                const drag = d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended);


                // Определение маркера стрелки
                svgGroup.append("defs")
                .append("marker")
                .attr("id", "arrowhead")
                .attr("markerWidth", 5) //Размер области, в которой будет отображаться маркер
                .attr("markerHeight", 4)
                .attr("refX", nodeView.r+4)
                .attr("refY", 2)
                .attr("orient", "auto")
                .append("polygon")
                .attr("points", "0 0, 5 2, 0 4")
                .style("fill", colors.link);

                
                //Добавление ссылок
                let links = svgGroup.append("g").attr('class', 'links')
                .selectAll('.link')
                .data(graphData.links) //Добавление данных
                .enter() //Нужен для ввода дополнительных значений (так как data привязывает только первое)
                .append('path')
                .attr('class', 'link')
                .attr('stroke', d=>{
                    //if((d.source.id === selectedNodes.sourseNode && d.target.id === selectedNodes.targetNode)||(d.target.id === selectedNodes.sourseNode && d.source.id === selectedNodes.targetNode)) return colors.selectLink
                    return colors.link
                }) // Цвет линии ребра
                .attr('stroke-width', d=>{
                    //if((d.source.id === selectedNodes.sourseNode && d.target.id === selectedNodes.targetNode)||(d.target.id === selectedNodes.sourseNode && d.source.id === selectedNodes.targetNode)) return 2
                    return 1
                }) // Ширина линии ребра
                .attr("marker-end", "url(#arrowhead)") // Добавление стрелки в конец ребра
                .style('pointer-events', 'none') //(устанавливает стиль) Отключение событий на ребрах (клики и т.д.)

                // Создание узлов
                let nodes = svgGroup.append("g").attr('class', 'nodes')
                .selectAll('.node')
                .data(graphData.nodes)
                .enter()
                .append('g')
                .attr('class', 'node')
                .call(drag);

                nodes.append('circle')
                .attr('class', 'node')
                .attr('id', d => d.id)
                .attr('r', d => d.r) // Радиус узла
                .attr('fill', d=>{
                    //if(selectedNodes.sourseNode === d.id || selectedNodes.targetNode === d.id) return colors.selectNode
                    return colors.node
                }) // Цвет заполнения
                .attr("cursor", "pointer")
                .on('click', (event, d) => {
                    // Добавьте логику для обработки клика по узлу
                });

                //Отображение текста v2
                nodes.append('foreignObject')
                .attr('x', d => -d.r * 0.8)
                .attr('y', d => -d.r * 0.8)
                .attr('width', d => d.r * 1.6)
                .attr('height', d => d.r * 1.6)
                .append('xhtml:div')
                .style('display', 'flex')
                .style('justify-content', 'center')
                .style('align-items', 'center')
                .style('width', '100%')
                .style('height', '100%')
                .style('font-size', '5px')
                .style('text-anchor', 'middle')
                .style('word-wrap', 'break-word')
                .style('overflow', 'hidden')
                .style('pointer-events', 'none')
                .text(d => d.name);

                //Создание симуляции силы v3
                const simulation = d3.forceSimulation(graphData.nodes)
                // Связи между узлами
                .force("link", d3.forceLink(graphData.links).id(d => d.id))//.distance(nodeView.r*10)) //!!! Сила в зависимости от количества узлов в уровне!!!!!
                // Отталкивание узлов
                .force("charge", d3.forceManyBody(graphData.nodes).strength(d=>graphData.levelsInfo.levelNodesCount[d.level]*(-100)))//-3000))
                // Центрирование по x
                .force("center", d3.forceCenter( window_params.width / 2,  window_params.height / 2))
                // Выравнивание по уровням
                .force("y", d3.forceY().strength(6)
                    .y(d =>  window_params.height * ((d.level+1) / (graphData.maxLevel-1)))) //!!!!!!!!!!Уровень с большим числом узлов шире, чем с меньшим
                // Отталкивание по x в рамках одного уровня
                .force("x", d3.forceX().strength(0.05)
                    .x( window_params.width / 2))
                // Дополнительная сила для предотвращения наложения узлов
                .force("collision", d3.forceCollide().radius(40));

                // Обновление позиций узлов и связей при каждой итерации симуляции
                //Обновление симуляции
                simulation.on('tick', () => {
                    links.attr("d", d => `M${d.source.x},${d.source.y} L${d.target.x},${d.target.y}`);
                    nodes.attr('transform', d => `translate(${d.x}, ${d.y})`); // Правильная позиция для групп
                });
            }
        </script>
    </body>
</html>